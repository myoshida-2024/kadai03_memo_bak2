<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ランチメモ</title>
    <script src="js/jquery-2.1.3.min.js"></script>
    <link rel="stylesheet" href="css/sample.css" />
  </head>

  <div class="mainvisual">
    <div class="layer layer-bg items-start">
      <div class="layer-txt">
        <p class="text-white"> Lunch Memo </p>
      </div>
    </div> 
    </header>
  </div>

<body>
    <header>
    </header>

<main style="display: none">

<!-- Initial screen  -->
  <div id="start-screen" style="display: flex; justify-content: center; align-items: center; height: 50vh; gap:20px;">

    <input type="button" id="new-button" class="image-button image-button-text" value="入力 " 
    style="width: 240px; height: 100px; background-image: url('./img/restaurant-button.png'); 
    background-size: cover; background-repeat: no-repeat; background-position: center; 
    color: white; font-weight: bold; font-size: 36px; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    display: flex; align-items: center; justify-content: center; text-align: center;" />
    <input type="button" id="show-button" class="image-button image-button-text" value="参照 " 
    style="width: 240px; height: 100px; background-image: url('./img/restaurant-button.png'); 
    background-size: cover; background-repeat: no-repeat; background-position: center; 
    color: white; font-weight: bold; font-size: 36px; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    display: flex; align-items: center; justify-content: center; text-align: center;" />

  </div>

<!-- New screen -->
  <div id="new-screen" style="display:none;">
    <div class="layer ">
      <div class="grid-container">
        
        <div class="grid-item">レストラン名</div>
        <div class="grid-item">
          <!-- <textarea name="name" id="name" cols="36" rows="1" class="border border-blue-400" -->
            <!-- style="align-items: start;"></textarea> -->
            <input type="text" id="name" name="name" 
                placeholder="レストラン名を入力" 
                required class="w-2/3 ml-4 bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-2 px-3 leading-8 transition-colors duration-200 ease-in-out">
        </div>
  
        <div class="grid-item">URL</div>
        <div class="grid-item">
          <!-- <textarea name="kana" id="kana" cols="36" rows="1" class="border border-blue-400" -->
            <!-- style="align-items: start;"></textarea> -->
            <input type="url" id="url" name="url" style="width: 400px"
                placeholder="レストラン情報URLを入力" 
                required class="w-2/3 ml-4 bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-2 px-3 leading-8 transition-colors duration-200 ease-in-out">
      
        </div>
  
        <div class="grid-item">カテゴリー</div>
        <div class="grid-item">
          <select id="category" class="border border-blue-400" style="width:150px">
            <option value="" selected disabled>選択してください</option>
            <option value="和食"> 和食</option>
            <option value="中華">中華</option>
            <option value="イタリアン">イタリアン</option>
            <option value="フレンチ">フレンチ</option>
            <option value="エスニック">エスニック</option>
            <option value="その他">その他</option>
          </select>
        </div>
  
        <div class="grid-item">評価</div>
        <div class="grid-item">
            <div class="rating w-2/3 ml-4">
              <input type="radio" id="star5" name="rating" value="5">
              <label for="star5" title="5 stars">★</label>
              <input type="radio" id="star4" name="rating" value="4">
              <label for="star4" title="4 stars">★</label>
              <input type="radio" id="star3" name="rating" value="3">
              <label for="star3" title="3 stars">★</label>
              <input type="radio" id="star2" name="rating" value="2">
              <label for="star2" title="2 stars">★</label>
              <input type="radio" id="star1" name="rating" value="1">
              <label for="star1" title="1 star">★</label>
            </div>
        </div>

        <div class="grid-item">感想メモ</div>
        <div class="grid-item">
          <input type="text" id="memo" name="details" style="width: 400px" 
          placeholder="感想を入力" required class="w-2/3 ml-4 bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-2 px-3 leading-8 transition-colors duration-200 ease-in-out">
        </div>

        <div class="grid-item">写真アップロード</div>
        <div class="grid-item">
         <input type="file" id="photo" name="photo" accept="image/*" class="w-2/3 ml-4 bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-2 px-3 leading-8 transition-colors duration-200 ease-in-out">
       </div>

      </div>
    </div>

    <div class="button-container" style="display: flex; justify-content: center; align-items: center; margin-top: 20px;">
      <button id="saveButton">保存</button>
    </div>

  </section>
</div>
   

<!-- Show screen -->
<div id="show-screen" style="display:none;">
  
  <section id="Filter" class="text-gray-600 body-font">
    <div class="container px-5 py-4 mx-auto mt-6 ">
      <div class="lg:w-full md:w-full mx-auto ">
        <form action="#" method="post" class="space-y-8 ">
          <!-- フィルター -->
          <div class="flex items-center border-b border-gray-300 pb-4">
            <label for="selectCategory" class="w-1/3 small-text">カテゴリー</label>
            <select id="selectCategory" name="selectCategory" class="w-2/3 ml-4 bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-2 px-3 leading-8 transition-colors duration-200 ease-in-out">
              <option value="すべて">すべて</option>
              <option value="和食">和食</option>
              <option value="中華">中華</option>
              <option value="イタリアン">イタリアン</option>
              <option value="フレンチ">フレンチ</option>
              <option value="エスニック">エスニック</option>
              <option value="その他">その他</option>
            </select>
          </div>
      </form>
      <div class="button-container" style="display: flex; justify-content: center; align-items center; margin-top: -30px; margin-bottom: 50px;">
        <button id="Filter">カテゴリー選択</button>
      </div>
      </div>
    </div>
  </section>
  <div id="sorted-content"></div>
</div>
</main>

    <footer style="font-size:medium">G's</footer>

<script>

 
    let obj=[];

      $("main").slideDown(10);

// ボタンのクリックイベントで入力画面に切り替える
    $("#new-button").on("click", function () {
        $("#start-screen").hide();
        $("#new-screen").show();
      });

// ボタンのクリックイベントで出力画面に切り替える
      $("#show-button").on("click", function () {
        $("#start-screen").hide();
        $("#show-screen").show();

        $("#Filter").on("click", function () {
        let selectedCategory = $("#selectCategory").val(); // 選択されたカテゴリーを取得
        console.log (selectedCategory);  
      

       // ローカルストレージから値を取得
      let R_obj = localStorage.getItem("R_obj"); // 既存のデータを取得
      let existingData = R_obj ? JSON.parse(R_obj) : [];

     // outputHtmlの初期化
      let outputHtml = "<ul style='display: flex; flex-wrap: wrap; gap: 10px; padding:0; margin:0; list-style:none;'>";

      if (selectedCategory == "すべて") {
        console.log("すべて");
       // すべてのデータを表示
       existingData.forEach(function(item) {
            outputHtml += "<li style='display: flex; align-items: flex-start; gap: 10px; border: 1px solid #ddd; padding: 10px; box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);'>";
            
            // テキストの塊をdivで囲む
            outputHtml += "<div style='width: 200px;'>";
            outputHtml += item.r_date + "<br>";       
            outputHtml += item.r_name + "<br>";
            outputHtml += " <a href='" + item.r_url + "' target='_blank'>" + item.r_url + "</a><br>";
            outputHtml += item.r_category + "<br>";
            outputHtml += item.r_rating + "<br>";
            outputHtml += item.r_memo + "<br>";
            outputHtml += "</div>";

            // 画像として表示
            if (item.r_photo) {
                outputHtml += "<img src='" + 
                item.r_photo + "' alt='写真' style='max-width: 200px; max-height: 200px;'><br>";
            }
            outputHtml += "</li>";
        });
      }
      else {
      // 選択されたカテゴリーでデータをフィルタリング
      let filteredData = existingData.filter(function(item) {
            return item.r_category === selectedCategory;
        });

        filteredData.forEach(function(item) { // ここでfilteredDataを使う
            outputHtml += "<li style='display: flex; align-items: flex-start; gap: 10px; border: 1px solid #ddd; padding: 10px; box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);'>";
        
            // テキストの塊をdivで囲む
            outputHtml += "<div style='width: 200px;'>";
            outputHtml += item.r_date + "<br>";       
            outputHtml += item.r_name + "<br>";
            outputHtml += " <a href='" + item.r_url + "' target='_blank'>" + item.r_url + "</a><br>";
            outputHtml += item.r_category + "<br>";
            outputHtml += item.r_rating + "<br>";
            outputHtml += item.r_memo + "<br>";
            outputHtml += "</div>";

            // 画像として表示
            if (item.r_photo) {
                outputHtml += "<img src='" + 
                item.r_photo + "' alt='写真' style='max-width: 200px; max-height: 200px;'><br>";
            }
            outputHtml += "</li>";
        });
      }

      outputHtml += "</ul>";

      // sorted-content内に表示
      $("#sorted-content").html(outputHtml);
      $("#sorted-content").css("font-size","16px");
    
    });
  })
        
      //1.Save クリックイベント
      $("#saveButton").on("click", function () {
        let today = new Date();
        let year = today.getFullYear();
        let month = String(today.getMonth() + 1).padStart(2, '0');
        let day = String(today.getDate()).padStart(2, '0');
        // "YYYY-MM-DD" 形式の日付文字列を作成
        let formattedDate = `${year}-${month}-${day}`;
    
        // ファイル入力から選択されたファイルを取得
        let fileInput = document.getElementById('photo');
        let file = fileInput.files[0];
   
        // ファイルをBase64形式に変換
        let reader = new FileReader();
        reader.readAsDataURL(file);

        let rating = $("input[name='rating']:checked").val(); // 選択された星評価を取得
       

        reader.onload = function() {
        let R_obj = {
            r_name: $("#name").val(),
            r_url: $("#url").val(),
            r_category: $("#category").val(),
            r_memo: $("#memo").val(),
            r_date: formattedDate,
            r_photo: reader.result, // ここにBase64エンコードされた画像データを格納
            r_rating: rating
          };


        let existingObj = localStorage.getItem("R_obj"); // 既存のデータを取得
        let existingData = existingObj ? JSON.parse(existingObj) : [];
       
      // 配列に追加する
      existingData.push(R_obj);

        // ローカルストレージにオブジェクト全体を保存
       localStorage.setItem("R_obj", JSON.stringify(existingData));
       alert("保存しました");

        // ローカルストレージに r_Idを個別に保存
        // localStorage.setItem("r_Id", R_obj.r_Id);
      }
    }
    );
    
    </script>
     <script src="./js/script.js"></script>
  </body>
</html>
